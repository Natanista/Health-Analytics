<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Dashboard</title>
	<link rel="shortcut icon" href="img/esculápio.png">
	<link rel="stylesheet" href="dashboard_chart.css">
	<!-- script do google charts -->
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript" src="funcoes.js"></script>


	<style>
		/* Classes CSS para exemplos de alertas */

		.normal {
			background-color: #22d422;
		}

		.alerta-alto {
			background-color: rgb(219, 59, 59);

		}

		.alerta-baixo {
			background-color: rgb(131, 99, 221);

		}

		.selectSetores {
			width: 300px;
			background: rgb(36, 193, 214);
			color: black;
			border: none;
			height: 60px;
			font-size: 30px;
			text-align: center;
			margin-left: 1500px;
		}

		.title {
			font-size: 40px;
		}
	</style>
</head>

<body onload="atualizacaoPeriodica(), verificar_autenticacao()">
	<!--HEADER-->

	<div class="header">
		<a href="login.html"></a>
		<a href="index.html"><img src="img/logo_home_color_dark.png" alt=""></a>


		<nav class="nav">
			<ul>
				<li>
					<p>OLÁ <b id="b_usuario"></b></p>
				</li>
				<li><a href="#" onclick="logoff()">LOGOUT</a></li>
			</ul>
		</nav>
		</h2>
	</div>
	<div class="legenda">
		<span><button id="vermelho"></button> <b> Temperatura alta</b></span>

		<span><button id="verde"></button><b> Temperatura adequada</b></span>

		<span><button id="azul"></button><b> Temperatura baixa</b></span></div>


	<div>
		<select id="setorSeletor" onchange="mudarSetor()" class="selectSetores">
			<option value="">--Selecione um setor--</option>
			<option value="criticos"> Criticos</option>
			<option value="setor1">Setor 1</option>
			<option value="setor2">Setor 2</option>
			<option value="todosSetores">Todos setores</option>
		</select></h3>

		<div id="geral">

			<div id="temperaturaGeral" style="display: none;">

				<h1 class="title">Temperaturas(ºC) - Todos setores </h1>

				<a style="color: black; text-decoration: none;" href="tela1.html">
					<div id="div_alerta_temperatura" class="temperatura1 normal">
						<p name="nameleitura" id="idleitura" value="1">Marcos Santos</p>
						<h2 id="div_temperatura">0º</h2>
						<span><b>Setor 1</b></span>
					</div>
				</a>

				<a style="color: black; text-decoration: none;" href="tela2.html">
					<div id="div_alerta_temperatura2" class="temperatura1 normal">
						<p name="nameleitura" id="idleitura" value="2">Maria Clara Silva</p>
						<h2 id="div_temperatura2">0°</h2>
						<span><b>Setor 2</b></span>
					</div>
				</a>

				<a style="color: black; text-decoration: none;" href="tela3.html">
					<div id="div_alerta_temperatura3" class="temperatura1 normal">
						<p name="nameleitura" id="idleitura" value="3">Rogerio Souza </p>
						<h2 id="div_temperatura3">0°</h2>
						<span><b>Setor 2</b></span>
					</div>
				</a>

				<a style="color: black; text-decoration: none;" href="tela4.html">

					<div id="div_alerta_temperatura4" class="temperatura1 normal">
						<p name="nameleitura" id="idleitura" value="4"> Evandro Costa</p>
						<h2 id="div_temperatura4">0°</h2>
						<span><b>Setor 2</b></span>
					</div>
				</a>

				<div class="temperatura1 alerta-baixo">
					<p>Natan Oliveira</p>
					<h2>33°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 alerta-baixo">
					<p>Eduardo Verri</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 normal">
					<p>Fabio da Silva</p>
					<h2>36°</h2>
					<span><b>Setor 1</b></span>
				</div>

				<div class="temperatura1 normal">
					<p>Julia Abraão</p>
					<h2>37°</h2>
					<span><b>Setor 1</b></span>
				</div>

				<div class="temperatura1 alerta-alto">
					<p>Cida Moura</p>
					<h2>39.7°</h2>
					<span><b>Setor 3</b></span>
				</div>

				<div class="temperatura1 alerta-baixo">
					<p>Kevin Santos</p>
					<h2>33°</h2>
					<span><b>Setor 3</b></span>
				</div>

				<div class="temperatura1 alerta-alto">
					<p>Bianca Costa</p>
					<h2>38.9°</h2>
					<span><b>Setor 3</b></span>
				</div>

				<div class="temperatura1 normal">
					<p>Vinicius Carvalho</p>
					<h2>36°</h2>
					<span><b>Setor 3</b></span>
				</div>

				<div class="temperatura1 normal">
					<p>Martin Santana</p>
					<h2>37°</h2>
					<span><b>Setor 3</b></span>
				</div>

				<div class="temperatura1 alerta-alto">
					<p>Kaline Barreira</p>
					<h2>40°</h2>
					<span><b>Setor 3</b></span>
				</div>

				<div class="temperatura1 alerta-alto">
					<p>Julia Ribeiro</p>
					<h2>42.3°</h2>
					<span><b>Setor 1</b></span>
				</div>

				<div class="temperatura1 normal">
					<p>Celia Taniwaki</p>
					<h2>34°</h2>
					<span><b>Setor 1</b></span>
				</div>

				<div class="temperatura1 normal">
					<p>Eduardo Verri</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 alerta-alto">
					<p>Claudia Santos</p>
					<h2>39°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 alerta-baixo">
					<p>Vivian Silva</p>
					<h2>34°</h2>
					<span><b>Setor 1</b></span>
				</div>

				<div class="temperatura1 normal">
					<p>Natan Oliveira</p>
					<h2>33°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 alerta-alto">
					<p>Cida Moura</p>
					<h2>39.7°</h2>
					<span><b>Setor 3</b></span>
				</div>

				<div class="temperatura1 alerta-baixo">
					<p>João Silva</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 normal">
					<p>Thiago Bonacelli</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>


				<div class="temperatura1 normal">
					<p>Bianca Costa</p>
					<h2>38.9°</h2>
					<span><b>Setor 3</b></span>
				</div>

				<div class="temperatura1 normal">
					<p>Tania Costa</p>
					<h2>35°</h2>
					<span><b>Setor 1</b></span>
				</div>


				<div class="temperatura1 alerta-alto">
					<p>Kaline Barreira</p>
					<h2>40°</h2>
					<span><b>Setor 3</b></span>
				</div>

				<div class="temperatura1 normal">
					<p>Maria Julia</p>
					<h2>34°</h2>
					<span><b>Setor 1</b></span>
				</div>


				<div class="temperatura1 normal">
					<p>Guilherme Oliveira</p>
					<h2>38°</h2>
					<span><b>Setor 2</b></span>
				</div>
			</div>


			<div style="display: none;" id="setor1">
				<h1 class="title">Temperaturas(ºC) - SETOR 1</h1>

				<div class="temperatura1 alerta-baixo">
					<p>Thiago Bonacelli</p>
					<h2>34°</h2>
					<span><b>Setor 1</b></span>
				</div>


				<div class="temperatura1 normal">
					<p>Claudio Frizzarini</p>
					<h2>36°</h2>
					<span><b>Setor 1</b></span>
				</div>


				<div class="temperatura1 normal">
					<p>Celia Taniwaki</p>
					<h2>34°</h2>
					<span><b>Setor 1</b></span>
				</div>


				<div class="temperatura1 normal">
					<p>Vivian Silva</p>
					<h2>34°</h2>
					<span><b>Setor 1</b></span>
				</div>


				<div class="temperatura1 normal">
					<p>Giuliana Miniguit</p>
					<h2>39°</h2>
					<span><b>Setor 1</b></span>
				</div>



				<div class="temperatura1 alerta-alto">
					<p>Gustavo Jesus</p>
					<h2>39°</h2>
					<span><b>Setor 1</b></span>
				</div>
			</div>


			<div style="display: block;" id="setorCritico">
				<h1 class="title">Temperaturas(ºC) - CRITICAS</h1>

				<div class="temperatura1 alerta-baixo">
					<p>João Silva</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>


				<div class="temperatura1 alerta-alto">
					<p>Claudia Santos</p>
					<h2>40.2°</h2>
					<span><b>Setor 2</b></span>
				</div>


				<div class="temperatura1 alerta-baixo">
					<p>Tania Costa</p>
					<h2>35°</h2>
					<span><b>Setor 1</b></span>
				</div>
				<div class="temperatura1 alerta-baixo">
					<p>Thiago Bonacelli</p>
					<h2>34°</h2>
					<span><b>Setor 1</b></span>
				</div>
				<div class="temperatura1 alerta-alto">
					<p>Gustavo Jesus</p>
					<h2>39°</h2>
					<span><b>Setor 2</b></span>
				</div>


				<div class="temperatura1 alerta-alto">
					<p>Julia Ribeiro</p>
					<h2>42.3°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 alerta-alto">
					<p>Claudia Santos</p>
					<h2>39°</h2>
					<span><b>Setor 2</b></span>
				</div>
				<div class="temperatura1 alerta-baixo">
					<p>Vivian Silva</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 alerta-alto">
					<p>Cida Moura</p>
					<h2>39.7°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 alerta-baixo">
					<p>João Silva</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 alerta-alto">
					<p>Kaline Barreira</p>
					<h2>40°</h2>
					<span><b>Setor 2</b></span>
				</div>



				<div class="temperatura1 alerta-baixo">
					<p>Maria Julia</p>
					<h2>34°</h2>
					<span><b>Setor 1</b></span>
				</div>



				<div class="temperatura1 alerta-alto">
					<p>Julia Ribeiro</p>
					<h2>42.3°</h2>
					<span><b>Setor 1</b></span>
				</div>



				<div class="temperatura1 alerta-alto">
					<p>Guilherme Oliveira</p>
					<h2>39°</h2>
					<span><b>Setor 2</b></span>
				</div>
			</div>




			<div style="display: none;" id="setor2">
				<h1>Temperaturas(ºC) - SETOR 2</h1>

				<div class="temperatura1 alerta-alto">
					<p>Julia Ribeiro</p>
					<h2>42.3°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 normal">
					<p>Celia Taniwaki</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 normal">
					<p>Eduardo Verri</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 alerta-alto">
					<p>Claudia Santos</p>
					<h2>39°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 alerta-baixo">
					<p>Vivian Silva</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 normal">
					<p>Natan Oliveira</p>
					<h2>33°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 alerta-alto">
					<p>Cida Moura</p>
					<h2>39.7°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 alerta-baixo">
					<p>João Silva</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 normal">
					<p>Thiago Bonacelli</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>


				<div class="temperatura1 normal">
					<p>Bianca Costa</p>
					<h2>38.9°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 normal">
					<p>Tania Costa</p>
					<h2>35°</h2>
					<span><b>Setor 2</b></span>
				</div>


				<div class="temperatura1 alerta-alto">
					<p>Kaline Barreira</p>
					<h2>40°</h2>
					<span><b>Setor 2</b></span>
				</div>

				<div class="temperatura1 normal">
					<p>Maria Julia</p>
					<h2>34°</h2>
					<span><b>Setor 2</b></span>
				</div>


				<div class="temperatura1 normal">
					<p>Guilherme Oliveira</p>
					<h2>38°</h2>
					<span><b>Setor 2</b></span>
				</div>
			</div>
		</div>
	</div>
	<!--footer-->
	<div class="footer">
		<ul>
			<li><a target="_blank"
					href="https://drive.google.com/file/d/1Us3ATLb40wee5Whz3-aquOQb2WKFgLtB/view?usp=sharing">Manual de
					instalação/uso <img src="img/donwload.png" style="width: 30px;"></a></li>
		</ul>
	</div>
	<!--footer finish-->
</body>

</html>

<script>
	setorSeletor.value = "criticos";
	// função da select dos setores
	function mudarSetor() {
		let seletor = document.getElementById("setorSeletor").value;
		if (seletor == "criticos") {
			setorCritico.style.display = "block";
			temperaturaGeral.style.display = "none";
			setor1.style.display = "none";
			setor2.style.display = "none";
		}
		if (seletor == "setor1") {
			setorCritico.style.display = "none";
			temperaturaGeral.style.display = "none";
			setor1.style.display = "block";
			setor2.style.display = "none";
		}
		if (seletor == "setor2") {
			setorCritico.style.display = "none";
			temperaturaGeral.style.display = "none";
			setor1.style.display = "none";
			setor2.style.display = "block";
		}
		if (seletor == "todosSetores") {
			setorCritico.style.display = "none";
			temperaturaGeral.style.display = "block";
			setor1.style.display = "none";
			setor2.style.display = "none";
		}
		if (seletor == "") {
			setorCritico.style.display = "none";
			temperaturaGeral.style.display = "block";
			setor1.style.display = "none";
			setor2.style.display = "none";
		}


	}

	// <![CDATA[ 
	var ttChatLoaderS = document.createElement('script');
	document.tomticketChatLoaderScriptVersion = 2;
	ttChatLoaderS.src = 'https://health-analytics-2020.tomticket.com/scripts-chat/chat.min.js' +
		'?id=EP51036' +
		'&account=3266304P30112020054447' +
		'&autoOpen=0' +
		'&hideWhenOffline=0' +
		'&d=health-analytics-2020' +
		'&ts=' + new Date().getTime() +
		'&ref=' + encodeURIComponent(document.URL);
	document.body.appendChild(ttChatLoaderS);
	//]]>


	// só mexer se quiser alterar o tempo de atualização
	// ou se souber o que está fazendo!
	function atualizacaoPeriodica() {
		obterdadosporleitura(1);
		obterdadosporleitura(2);
		obterdadosporleitura(3);
		obterdadosporleitura(4);
		setTimeout(atualizacaoPeriodica, 5000);
	}



	function obterdadosporleitura(idleitura) {
		//aguardar();
		fetch(`/leituras/tempo-real/${idleitura}`)
			.then(resposta => {

				if (resposta.ok) {
					resposta.json().then(function (resposta) {

						console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

						// aqui, após registro. use os nomes 
						// dos atributos que vem no JSON 
						var dados = {
							temperatura: resposta.temperatura
						}

						alertar(resposta.temperatura, idleitura);
						atualizarTela(dados, idleitura);
					});
				} else {

					console.error('Nenhum dado encontrado ou erro na API');
				}
			})
			.catch(function (error) {
				console.error(`Erro na obtenção dos dados do usuario p/ gráfico: ${error.message}`);
			});
	}

	function alertar(temperatura, idleitura) {
		// padrão para meu alerta
		var limites = {
			max_temperatura: 37.8,
			min_temperatura: 35.5
		};

		// zerar aviso de mensagem

		var classe_temperatura = 'temperatura1';

		// comparando
		if (temperatura > limites.max_temperatura) {

			classe_temperatura = 'temperatura1 alerta-alto';
		}

		if (temperatura < limites.min_temperatura) {

			classe_temperatura = 'temperatura1 alerta-baixo';
		}

		if (temperatura >= limites.min_temperatura && temperatura <= limites.max_temperatura) {
			classe_temperatura = 'temperatura1 normal';
		}


		// escolhendo qual alterar
		var div_temperatura_alterar


		if (idleitura == 1) {
			div_temperatura_alterar = div_alerta_temperatura
		} else if (idleitura == 2) {
			div_temperatura_alterar = div_alerta_temperatura2

		} else if (idleitura == 3) {
			div_temperatura_alterar = div_alerta_temperatura3

		} else if (idleitura == 4) {
			div_temperatura_alterar = div_alerta_temperatura4

		}

		// alterando

		div_temperatura_alterar.className = classe_temperatura;
	}

	// só altere aqui se souber o que está fazendo!
	function atualizarTela(dados, idleitura) {
		console.log('iniciando atualização da tela...');

		// escolhendo qual alterar
		var div_temperatura_alterar


		if (idleitura == 1) {
			div_temperatura_alterar = div_temperatura
		} else if (idleitura == 2) {
			div_temperatura_alterar = div_temperatura2

		} else if (idleitura == 3) {
			div_temperatura_alterar = div_temperatura3

		} else if (idleitura == 4) {
			div_temperatura_alterar = div_temperatura4
		}

		div_temperatura_alterar.innerHTML = `${dados.temperatura.toFixed(2)}`;

	}


	function sendData() {
		var http = new XMLHttpRequest();
		http.open('GET', 'http://localhost:9000/api/sendData', false);
		http.send(null);
	}

	setInterval(() => {
		sendData();
	}, 5000);
</script>